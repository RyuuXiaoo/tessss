const cfg=window.AppConfig||{security:{adminUser:'admin',adminPass:'ryuu'}};const st={get(){try{return JSON.parse(localStorage.getItem('rx_products')||'null')}catch{return null}},set(v){localStorage.setItem('rx_products',JSON.stringify(v))}};const bal={set(n){localStorage.setItem('rx_balance',String(n))}};let data=st.get()||{categories:[],products:[]};const gate=document.getElementById('gate'),area=document.getElementById('adminArea');document.getElementById('loginBtn').onclick=()=>{const u=document.getElementById('u').value.trim(),p=document.getElementById('p').value.trim();if(u===cfg.security.adminUser&&p===cfg.security.adminPass){gate.style.display='none';area.style.display='block';render()}else alert('Username/Password salah')};document.getElementById('setBalance').onclick=()=>{const n=Number(document.getElementById('balanceInput').value||'0');bal.set(n);alert('Saldo di-set')};document.getElementById('saveProduct').onclick=()=>{const p={id:id.value.trim(),name:name.value.trim(),price:Number(price.value||'0'),profit:Number(profit.value||'0'),category:category.value.trim(),desc:desc.value.trim(),snk:snk.value.trim(),terjual:0,stok:[]};if(!p.id||!p.name)return alert('ID & nama wajib');const ex=(data.products||[]).find(x=>x.id===p.id);if(ex){ex.name=p.name;ex.price=p.price;ex.profit=p.profit;ex.category=p.category;ex.desc=p.desc;ex.snk=p.snk}else{data.products.push(p);if(p.category&&!(data.categories||[]).includes(p.category))(data.categories||[]).push(p.category)}st.set(data);render();alert('Tersimpan')};document.getElementById('addStock').onclick=()=>{const pid=document.getElementById('sid').value.trim();const it=(data.products||[]).find(x=>x.id===pid);if(!it)return alert('Produk tidak ditemukan');const lines=(document.getElementById('stockArea').value||'').split('\n').map(s=>s.trim()).filter(Boolean);const over=Number(document.getElementById('sprice').value||'0');const mapped=lines.map(l=>{const arr=l.split('|');while(arr.length<6)arr.push('');if(over>0)arr[5]=String(over);return arr.join('|')});it.stok.push(...mapped);st.set(data);render();alert('Stok ditambahkan: '+mapped.length)};document.getElementById('clearStock').onclick=()=>{const pid=document.getElementById('sid').value.trim();const it=(data.products||[]).find(x=>x.id===pid);if(!it)return alert('Produk tidak ditemukan');if(!confirm('Kosongkan stok untuk '+pid+'?'))return;it.stok=[];st.set(data);render()};function render(){const tb=document.querySelector('#prodTable tbody');tb.innerHTML=(data.products||[]).map(p=>`<tr><td>${p.id}</td><td>${p.name}</td><td style="text-align:center">${p.price}</td><td style="text-align:center">${p.category||'-'}</td><td style="text-align:center">${p.stok.length}</td><td style="text-align:center">${p.terjual||0}</td></tr>`).join('')}