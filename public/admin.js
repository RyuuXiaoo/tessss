const cfg=window.AppConfig||{security:{adminUser:'admin',adminPass:'ryuu'}};const store={get(){try{return JSON.parse(localStorage.getItem('rx_products')||'null')}catch{return null}},set(d){localStorage.setItem('rx_products',JSON.stringify(d))}};const balanceStore={set(n){localStorage.setItem('rx_balance',String(n))}};let data=store.get()||{categories:['Streaming','Game','Tools'],products:[]};const gate=document.getElementById('gate');const adminArea=document.getElementById('adminArea');document.getElementById('loginBtn').onclick=()=>{const u=document.getElementById('u').value.trim();const p=document.getElementById('p').value.trim();if(u===cfg.security.adminUser&&p===cfg.security.adminPass){gate.style.display='none';adminArea.style.display='block';renderTable()}else alert('Username/Password salah')};document.getElementById('setBalance').onclick=()=>{const n=Number(document.getElementById('balanceInput').value||'0');balanceStore.set(n);alert('Saldo di-set')};document.getElementById('saveProduct').onclick=()=>{const p={id:id.value.trim(),name:name.value.trim(),price:Number(price.value||'0'),profit:Number(profit.value||'0'),category:category.value.trim(),desc:desc.value.trim(),snk:snk.value.trim(),terjual:0,stok:[]};if(!p.id||!p.name)return alert('ID & Nama wajib');const ex=data.products.find(x=>x.id===p.id);if(ex){ex.name=p.name;ex.price=p.price;ex.profit=p.profit;ex.category=p.category;ex.desc=p.desc;ex.snk=p.snk}else{data.products.push(p);if(p.category&&!data.categories.includes(p.category))data.categories.push(p.category)}store.set(data);renderTable();alert('Tersimpan')};document.getElementById('addStock').onclick=()=>{const pid=document.getElementById('sid').value.trim();const p=data.products.find(x=>x.id===pid);if(!p)return alert('Produk tidak ditemukan');const lines=(document.getElementById('stockArea').value||'').split('\n').map(s=>s.trim()).filter(Boolean);const over=Number(document.getElementById('sprice').value||'0');const mapped=lines.map(l=>{const arr=l.split('|');while(arr.length<6)arr.push('');if(over>0)arr[5]=String(over);return arr.join('|')});p.stok.push(...mapped);store.set(data);renderTable();alert('Stok ditambahkan: '+mapped.length)};document.getElementById('clearStock').onclick=()=>{const pid=document.getElementById('sid').value.trim();const p=data.products.find(x=>x.id===pid);if(!p)return alert('Produk tidak ditemukan');if(!confirm('Kosongkan stok untuk '+pid+'?'))return;p.stok=[];store.set(data);renderTable()};function renderTable(){const tb=document.getElementById('prodTable');tb.innerHTML='<tr><th>ID</th><th>Nama</th><th>Harga</th><th>Kategori</th><th>Stok</th><th>Terjual</th></tr>'+data.products.map(p=>`<tr><td>${p.id}</td><td>${p.name}</td><td>${p.price}</td><td>${p.category||'-'}</td><td>${p.stok.length}</td><td>${p.terjual||0}</td></tr>`).join('')}
